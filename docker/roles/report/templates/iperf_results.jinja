{% from "macros.jinja" import line with context %}

{% macro iperf_results(results) %}
  {% for group in results|groupby('_label') %}
  {% set lines = group.list %}
     <div class="col-md-12">
       <h3>{{group.grouper|title}}</h3>
     </div>
     {% for destination in lines %}
       <div class="col-md-6">
        <table class="table table-bordered table-striped table-hover nv-table"> 
                <thead>
                  <tr>
                    <th colspan="8">{{destination.destination|resolve(ip_register)|string|title}}</th>
                  </tr>
                  <tr>
                    <th>Bits per second</th>
                    <th>Bytes</th>
                    <th>Start</th>
                    <th>End</th>
                  </tr>
                </thead>
                <tbody>
                {% if destination.get('_error', False) == False %}
                  {% set l =  destination %}
                      {% if l._success == 1 %}
                        {% set class = 'bg-success' %}
                      {% else %}
                        {% set class = 'bg-danger' %}
                      {% endif %}
                  
                      {{line([l.bits_per_second|size + 'bits/s', l.bytes|size + 'bytes' , l.start + ' s', l.end + ' s'], class=class, id=l._id)}}
                {% else %}
                      {{line([destination.message], colspan=4, class='bg-danger')}}
                {% endif %}
                <tbody>
        </table>
      </div>
    {% endfor %}
  {% endfor %}
{% endmacro %}
