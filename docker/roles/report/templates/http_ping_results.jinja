{% from "macros.jinja" import line with context %}

{% macro http_ping_results(results) %}

{% for group in results|groupby('_label') %}
{% set lines = group.list %}
 <div class="col-md-12">
  <h3>{{group.grouper|title}}</h3>
  <table class="table table-bordered table-striped table-hover nv-table"> 
          <thead>
            <tr>
              <th>Source</th>
              <th>Destination</th>
              <th>RTT</th>
              <th>Failed</th>
              <th>Total</th>
            </tr>
          </thead>
          <tbody>
          {% for l in lines %}
            {% if l._success == True %}
              {% set class = 'bg-success' %}
            {% else %}
              {% set class = 'bg-danger' %}
            {% endif %}

            {% if l.get('_error', False) == True %}
              <tr id="{{l._id}}">
                <td class="bg-danger">{{l._host|resolve(ip_register)}}</td>
                <td class="bg-danger">{{l.destination|resolve(ip_register)}}</td>
                <td class="bg-danger" colspan=5>{{l.message}}</td>
              </tr>
            {% else %}              
              {{line([l._host|resolve(ip_register), l.destination|resolve(ip_register), l.rtt + ' ms', l.failed, l.total], class=class, id=l._id)}}
            {% endif %}
          {% endfor %}  
          <tbody>
  </table>
</div>
{% endfor %}

{% endmacro %}
