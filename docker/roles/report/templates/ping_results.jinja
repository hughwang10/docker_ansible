{% from "macros.jinja" import line with context %}

{% macro ping_results(results) %}

{% for group in results|groupby('_label') %}
{% set lines = group.list %}
 <div class="col-md-12">
  <h3>{{group.grouper|title}}</h3>
  <table class="table table-bordered table-striped table-hover nv-table"> 
          <thead>
            <tr>
              <th colspan="4"></th>
              <th colspan="4">RTT (ms)</th>
            </tr>
            <tr>
              <th>Source</th>
              <th>Destination</th>
              <th>Transmitted</th>
              <th>Loss</th>
              <th>Max</th>
              <th>Min</th>
              <th>Mdev</th>
              <th>Average</th>
            </tr>
          </thead>
          <tbody>
          {% for l in lines %}
            {% if l._success == True %}
              {% set class = 'bg-success' %}
            {% else %}
              {% set class = 'bg-danger' %}
            {% endif %}
              
            {% if l.rtt is not defined %}
              {{line([l.message], colspan=8, class=class, id=l._id)}}
            {% elif l.rtt.max is not defined %}
              {{line([l._host|resolve(ip_register), l.destination|resolve(ip_register), l.transmitted, l.loss + '%'], class=class, id=l._id)}}
            {% else %}
              {{line([l._host|resolve(ip_register), l.destination|resolve(ip_register), l.transmitted, l.loss + '%', l.rtt.max, l.rtt.min, l.rtt.mdev, l.rtt.avg], class=class, id=l._id)}}
            {% endif %}
          {% endfor %}  
          <tbody>
  </table>
</div>
{% endfor %}

{% endmacro %}
