{% from "macros.jinja" import line with context %}

{% macro mtr_results(results) %}
  {% for group in results|groupby('_label') %}
  {% set lines = group.list %}
     <div class="col-md-12">
       <h3>{{group.grouper|title}}</h3>
     </div>
     {% for destination in lines %}
        {% set danger = '' %}
        {% if destination._success == False %}
          {% set danger = 'danger' %}
        {% endif %}

       <div class="col-md-12">
        <table class="table table-bordered table-striped table-hover nv-table {{danger}}"> 
                <thead>
                  <tr>
                    <th colspan="8" id="{{destination._id}}">From {{destination._host|resolve(ip_register)|title}} to {{destination.destination|resolve(ip_register)|title}}</th>
                  </tr>
                  <tr>
                    <th>Host</th>
                    <th>Loss</th>
                    <th>Last</th>
                    <th>Worst</th>
                    <th>Jmax</th>
                    <th>Average</th>
                    <th>Best</th>
                    <th>Sent</th>
                  </tr>
                </thead>
                <tbody>
                {% if destination.get('_error', False) == False %}
                  {% for l in destination.hubs %}
                      {{line([l.host|resolve(ip_register), l.loss + '%', l.last|time_unit, l.wrst|time_unit, l.jmax|time_unit, l.avg|time_unit, l.best|time_unit, l.snt])}}
                  {% endfor %} 
                {% else %}
                  {{line([destination.message], 8)}}
                {% endif %}
                <tbody>
        </table>
      </div>
    {% endfor %}
  {% endfor %}
{% endmacro %}
